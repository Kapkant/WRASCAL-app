import{g as M,s as p}from"./searchResultStore-6b40880b.js";import{d as R,R as P,_ as S,o as c,c as y,w as n,a as s,O as g,P as d,W as T,N as o,T as h,X as V,Q as I,Y as _,Z as b,$ as f,a0 as v,a1 as $,U as L}from"./index-9a933907.js";import{M as K,k,P as F}from"./ProtonationDisplayUtil-b764c404.js";import{V as H,a as B}from"./VCol-1efbcb7d.js";import{V as N,a as E,b as O}from"./VCard-e16a2071.js";import{V as D}from"./VAlert-e60810ec.js";const C={name:"Name",form:"Protonation Level",central_element:"Metal",metal_charge:"Metal Charge",formula_string:"Formula String"},Q=R({name:"SearchResult",setup:()=>{P({title:"Search Results"})},data:()=>({itemsPerPage:50,pageSizeOptions:[10,25,50,100],headers:[{title:"Actions",key:"actions",sortable:!1},{title:"Name",align:"start",key:"name"},{title:"Protonation Level",align:"end",key:"form"},{title:"Metal Charge",align:"end",key:"metal_charge"},{title:"Formula String",align:"end",key:"formula_string"}],searchResult:[],groupBy:[],groupKeys:[],lastQuery:"",activeMetalFilter:"",constantsData:{},loadingConstants:{},constantHeaders:[{title:"Expression",align:"start",key:"expression_string"},{title:"Constant Kind",align:"end",key:"constant_kind"},{title:"Temp (Â°C)",align:"end",key:"temperature"},{title:"Ionic Strength (M)",align:"center",key:"ionic_strength"},{title:"Value",align:"start",key:"value"}],expandedRows:[]}),watch:{expandedRows:{handler(e,t){console.log("expandedRows changed:",e.length,"rows expanded");for(const r of e)if(r){const m=this.getItemData(r);if(m){const u=this.getMetalKey(m);console.log("Row expanded, metalKey:",u,"hasData:",!!this.constantsData[u]),!this.constantsData[u]&&!this.loadingConstants[u]&&(console.log("Loading constants for",u),this.loadConstants(m))}}},deep:!0}},methods:{returnToSearchPage(){this.$router.go(-1)},regroup(){const e=[];for(const t of this.groupKeys)t.isChecked&&e.push({key:t.key});this.groupBy=e},getItemData(e){return(e==null?void 0:e.raw)||e},getMetalKey(e){return`${e.central_element}_${e.metal_id}_${e.ligand_id}`},async loadConstants(e){const t=this.getMetalKey(e);if(console.log("loadConstants called for",t,"item:",e),this.constantsData[t]){console.log("Constants already loaded for",t);return}this.loadingConstants[t]=!0,console.log("Starting to load constants for",t);try{const r=await M(e.ligand_id,e.metal_id);console.log("Constants loaded for",t,"count:",(r==null?void 0:r.length)||0),r?this.constantsData[t]=r:this.constantsData[t]=[]}catch(r){console.error("Error loading constants for",t,":",r),this.constantsData[t]=[]}finally{this.loadingConstants[t]=!1,console.log("Finished loading constants for",t)}},formatValue(e,t){return t!==void 0?e.toPrecision(t):e.toString()},goToDetailPage(e){if(console.log("goToDetailPage called with item:",e),console.log("item.ligand_id:",e==null?void 0:e.ligand_id,"item.metal_id:",e==null?void 0:e.metal_id),!e||!e.ligand_id||!e.metal_id){console.error("Invalid item passed to goToDetailPage:",e),alert("Error: Missing required data (ligand_id or metal_id). Please try selecting a different result.");return}const t=p();t.selectedSearchResult=e,console.log("Set selectedSearchResult in store:",t.selectedSearchResult),this.$router.push("/detail-view")},openDetailInNewTab(e){const t=`${window.location.origin}/#/detail-view`,r=p();r.selectedSearchResult=e,window.open(t,"_blank")},async copyLink(e){const t=`${window.location.origin}/#/detail-view`;try{await navigator.clipboard.writeText(t)}catch{}},getFormattedMetalForm(e){if(!e)return"-";const t=K.formatMetalFormulaString(e);return k.renderToString(t,{displayMode:!0,throwOnError:!1})},getFormattedProtonationForm(e){if(!e)return"-";const t=F.formatProtonationString(e);return k.renderToString(t,{displayMode:!0,throwOnError:!1})},highlightMatch(e){if(!this.lastQuery)return e;const t=new RegExp(`(${this.lastQuery})`,"ig");return e.replace(t,'<span class="mark">$1</span>')},filterByMetal(e){this.activeMetalFilter=e;const t=p();this.searchResult=t.searchResult.filter(r=>r.central_element===e)}},mounted(){const e=p();console.log("SearchResult mounted - store.searchResult:",e.searchResult),console.log("First result sample:",e.searchResult[0]),e.searchResult[0]&&console.log("First result has ligand_id:",e.searchResult[0].ligand_id,"metal_id:",e.searchResult[0].metal_id),this.searchResult=e.searchResult,this.groupBy=[{key:"name"},{key:"central_element"}],this.groupKeys=[];for(const t of e.getKeys)C[t]!==void 0&&this.groupKeys.push({key:t,name:C[t],isChecked:t==="name"||t==="central_element"});this.lastQuery=e.lastQuery}});const U=o("div",null,[o("div",{class:"d-flex text-overline mb-1"}," OVERVIEW "),o("div",{class:"d-flex text-h6 mb-1"}," Search Result "),o("div",{class:"d-flex text-caption text-left"}," Here you can view the current search results and click on one of the entries to go to the details page for that compound. Clicking on the title in the table header will sort the items in ascending/descending order by that column. Click on the drop-down boxes and buttons at the bottom to control the content displayed on each page and switch between pages. ")],-1),z={class:"text-caption mr-3"},A={class:"text-left"},j=["colspan"],W=["innerHTML"],q=["colspan"],X={key:0,class:"text-center pa-4"},Y=o("div",{class:"mt-2"},"Loading constants...",-1),Z={key:1},G=o("div",{class:"text-subtitle-2 mb-3"},"Constants Data:",-1),J=["innerHTML"],x={class:"mt-3"},ee={key:2,class:"text-center pa-4"},te={class:"mt-3"},ae={key:3,class:"text-center pa-4"},ne=o("div",{class:"mt-2"},"Loading constants...",-1),se=["innerHTML"],oe=["innerHTML"],le=["innerHTML"],re=["innerHTML"];function ie(e,t,r,m,u,de){return c(),y(H,{class:"fill-height"},{default:n(()=>[s(L,{class:"d-flex text-center fill-height"},{default:n(()=>[s(N,{class:"mx-auto",variant:"outlined"},{default:n(()=>[s(E,null,{default:n(()=>[U]),_:1}),s(O,null,{default:n(()=>[s(g,{variant:"outlined","prepend-icon":"mdi-arrow-left",onClick:e.returnToSearchPage},{default:n(()=>[d(" Return To Search Page ")]),_:1},8,["onClick"]),s(T),o("div",z,h(e.searchResult.length)+" result(s)",1),s(V,{items:e.pageSizeOptions,modelValue:e.itemsPerPage,"onUpdate:modelValue":t[0]||(t[0]=a=>e.itemsPerPage=a),label:"Rows per page",density:"compact",style:{"max-width":"160px"}},null,8,["items","modelValue"])]),_:1})]),_:1}),s(I,{justify:"center",class:"pt-10"},{default:n(()=>[s(B,{cols:"12"},{default:n(()=>[e.searchResult.length===0?(c(),y(D,{key:0,type:"info",variant:"tonal",border:"start",class:"mb-6"},{default:n(()=>[d(" No results found. Try a different ligand name or adjust your filters. ")]),_:1})):(c(),y(_,{key:1,"items-per-page":e.itemsPerPage,"onUpdate:itemsPerPage":t[1]||(t[1]=a=>e.itemsPerPage=a),expanded:e.expandedRows,"onUpdate:expanded":t[2]||(t[2]=a=>e.expandedRows=a),"group-by":e.groupBy,headers:e.headers,items:e.searchResult,"item-value":"name","show-expand":"",class:"elevation-1"},{"group-header":n(({item:a,columns:i,toggleGroup:l,isGroupOpen:w})=>[o("tr",A,[o("td",{colspan:i.length},[s(g,{size:"small",variant:"text",class:b(`ml-${a.depth*5}`),icon:w(a)?"$expand":"$next",onClick:ce=>l(a)},null,8,["class","icon","onClick"]),o("span",{innerHTML:a.value},null,8,W)],8,j)])]),"expanded-row":n(({columns:a,item:i})=>[o("tr",null,[o("td",{colspan:a.length,class:"pa-4"},[e.loadingConstants[e.getMetalKey(e.getItemData(i))]?(c(),f("div",X,[s(v,{indeterminate:"",color:"primary"}),Y])):e.constantsData[e.getMetalKey(e.getItemData(i))]&&e.constantsData[e.getMetalKey(e.getItemData(i))].length>0?(c(),f("div",Z,[G,s(_,{headers:e.constantHeaders,items:e.constantsData[e.getMetalKey(e.getItemData(i))],"items-per-page":20,class:"elevation-1"},{"item.expression_string":n(({item:l})=>[o("div",{innerHTML:l.expression_string||"-"},null,8,J)]),"item.constant_kind":n(({item:l})=>[d(h(l.constant_kind||"-"),1)]),"item.temperature":n(({item:l})=>[d(h(l.temperature!==void 0?l.temperature+(l.temperature_varies?" (varies)":""):"-"),1)]),"item.ionic_strength":n(({item:l})=>[d(h(l.ionic_strength!==void 0?l.ionic_strength:"-"),1)]),"item.value":n(({item:l})=>[d(h(l.value!==void 0?e.formatValue(l.value,l.significant_figures):"-"),1)]),_:2},1032,["headers","items"]),o("div",x,[s(g,{color:"primary","prepend-icon":"mdi-share",onClick:l=>e.goToDetailPage(e.getItemData(i))},{default:n(()=>[d(" View Full Details ")]),_:2},1032,["onClick"])])])):e.constantsData[e.getMetalKey(e.getItemData(i))]&&e.constantsData[e.getMetalKey(e.getItemData(i))].length===0?(c(),f("div",ee,[s(D,{type:"info",variant:"tonal"},{default:n(()=>[d(" No constants data available for this metal-ligand combination. ")]),_:1}),o("div",te,[s(g,{color:"primary","prepend-icon":"mdi-share",onClick:l=>e.goToDetailPage(e.getItemData(i))},{default:n(()=>[d(" View Detail Page ")]),_:2},1032,["onClick"])])])):(c(),f("div",ae,[s(v,{indeterminate:"",color:"primary"}),ne]))],8,q)])]),"item.actions":n(({item:a})=>[s(g,{rounded:"pill",color:"primary","prepend-icon":"mdi-share",onClick:i=>e.goToDetailPage(e.getItemData(a))},{default:n(()=>[d(" Detail ")]),_:2},1032,["onClick"]),s(g,{class:"ml-2",rounded:"pill",color:"secondary","prepend-icon":"mdi-open-in-new",onClick:i=>e.openDetailInNewTab(e.getItemData(a))},{default:n(()=>[d(" Open ")]),_:2},1032,["onClick"]),s(g,{class:"ml-2",rounded:"pill",color:"tertiary","prepend-icon":"mdi-content-copy",onClick:i=>e.copyLink(e.getItemData(a))},{default:n(()=>[d(" Copy Link ")]),_:2},1032,["onClick"])]),"item.name":n(({item:a})=>[o("span",{innerHTML:e.highlightMatch(e.getItemData(a).name)},null,8,se)]),"item.molecular_formula":n(({item:a})=>[o("div",{innerHTML:e.getItemData(a).molecular_formula},null,8,oe)]),"item.form":n(({item:a})=>[o("div",{class:"no-katex-html",innerHTML:e.getFormattedProtonationForm(e.getItemData(a).form)},null,8,le)]),"item.metal_charge":n(({item:a})=>[s($,{class:"ma-1",color:"blue",onClick:i=>e.filterByMetal(e.getItemData(a).central_element)},{default:n(()=>[d(h(e.getItemData(a).metal_charge>0?`+${e.getItemData(a).metal_charge}`:e.getItemData(a).metal_charge),1)]),_:2},1032,["onClick"])]),"item.formula_string":n(({item:a})=>[o("div",{class:"no-katex-html",innerHTML:e.getFormattedMetalForm(e.getItemData(a).formula_string)},null,8,re)]),_:2},1032,["items-per-page","expanded","group-by","headers","items"]))]),_:1})]),_:1})]),_:1})]),_:1})}const ye=S(Q,[["render",ie]]);export{ye as default};
