import{g as M,s as p}from"./searchResultStore-49415dc9.js";import{d as P,R as V,_ as R,o as c,c as f,w as n,a as o,O as u,P as d,W as T,N as s,T as h,X as D,Q as S,Y as y,Z as b,$ as m,a0 as _,a1 as $,U as L}from"./index-3713baf2.js";import{M as K,k as w,P as H}from"./ProtonationDisplayUtil-b764c404.js";import{V as x,a as F}from"./VCol-2bc3a678.js";import{V as B,a as N,b as E}from"./VCard-8fff2f65.js";import{V as v}from"./VAlert-c8f9939e.js";const k={name:"Name",form:"Protonation Level",central_element:"Metal",metal_charge:"Metal Charge",formula_string:"Formula String"},O=P({name:"SearchResult",setup:()=>{V({title:"Search Results"})},data:()=>({itemsPerPage:50,pageSizeOptions:[10,25,50,100],headers:[{title:"Actions",key:"actions",sortable:!1},{title:"Name",align:"start",key:"name"},{title:"Protonation Level",align:"end",key:"form"},{title:"Metal Charge",align:"end",key:"metal_charge"},{title:"Formula String",align:"end",key:"formula_string"}],searchResult:[],groupBy:[],groupKeys:[],lastQuery:"",activeMetalFilter:"",constantsData:{},loadingConstants:{},constantHeaders:[{title:"Expression",align:"start",key:"expression_string"},{title:"Constant Kind",align:"end",key:"constant_kind"},{title:"Temp (Â°C)",align:"end",key:"temperature"},{title:"Ionic Strength (M)",align:"center",key:"ionic_strength"},{title:"Value",align:"start",key:"value"}],expandedRows:[]}),watch:{expandedRows:{handler(e,t){console.log("expandedRows changed:",e.length,"rows expanded");for(const l of e)if(l&&l.raw){const g=this.getMetalKey(l.raw);console.log("Row expanded, metalKey:",g,"hasData:",!!this.constantsData[g]),!this.constantsData[g]&&!this.loadingConstants[g]&&(console.log("Loading constants for",g),this.loadConstants(l.raw))}},deep:!0}},methods:{returnToSearchPage(){this.$router.go(-1)},regroup(){const e=[];for(const t of this.groupKeys)t.isChecked&&e.push({key:t.key});this.groupBy=e},getMetalKey(e){return`${e.central_element}_${e.metal_id}_${e.ligand_id}`},async loadConstants(e){const t=this.getMetalKey(e);if(console.log("loadConstants called for",t,"item:",e),this.constantsData[t]){console.log("Constants already loaded for",t);return}this.loadingConstants[t]=!0,console.log("Starting to load constants for",t);try{const l=await M(e.ligand_id,e.metal_id);console.log("Constants loaded for",t,"count:",(l==null?void 0:l.length)||0),l?this.constantsData[t]=l:this.constantsData[t]=[]}catch(l){console.error("Error loading constants for",t,":",l),this.constantsData[t]=[]}finally{this.loadingConstants[t]=!1,console.log("Finished loading constants for",t)}},formatValue(e,t){return t!==void 0?e.toPrecision(t):e.toString()},goToDetailPage(e){const t=p();t.selectedSearchResult=e,this.$router.push("/detail-view")},openDetailInNewTab(e){const t=`${window.location.origin}/#/detail-view`,l=p();l.selectedSearchResult=e,window.open(t,"_blank")},async copyLink(e){const t=`${window.location.origin}/#/detail-view`;try{await navigator.clipboard.writeText(t)}catch{}},getFormattedMetalForm(e){if(!e)return"-";const t=K.formatMetalFormulaString(e);return w.renderToString(t,{displayMode:!0,throwOnError:!1})},getFormattedProtonationForm(e){if(!e)return"-";const t=H.formatProtonationString(e);return w.renderToString(t,{displayMode:!0,throwOnError:!1})},highlightMatch(e){if(!this.lastQuery)return e;const t=new RegExp(`(${this.lastQuery})`,"ig");return e.replace(t,'<span class="mark">$1</span>')},filterByMetal(e){this.activeMetalFilter=e;const t=p();this.searchResult=t.searchResult.filter(l=>l.central_element===e)}},mounted(){const e=p();this.searchResult=e.searchResult,this.groupBy=[{key:"name"},{key:"central_element"}],this.groupKeys=[];for(const t of e.getKeys)k[t]!==void 0&&this.groupKeys.push({key:t,name:k[t],isChecked:t==="name"||t==="central_element"});this.lastQuery=e.lastQuery}});const Q=s("div",null,[s("div",{class:"d-flex text-overline mb-1"}," OVERVIEW "),s("div",{class:"d-flex text-h6 mb-1"}," Search Result "),s("div",{class:"d-flex text-caption text-left"}," Here you can view the current search results and click on one of the entries to go to the details page for that compound. Clicking on the title in the table header will sort the items in ascending/descending order by that column. Click on the drop-down boxes and buttons at the bottom to control the content displayed on each page and switch between pages. ")],-1),U={class:"text-caption mr-3"},I={class:"text-left"},z=["colspan"],A=["innerHTML"],j=["colspan"],W={key:0,class:"text-center pa-4"},X=s("div",{class:"mt-2"},"Loading constants...",-1),Y={key:1},Z=s("div",{class:"text-subtitle-2 mb-3"},"Constants Data:",-1),q=["innerHTML"],G={class:"mt-3"},J={key:2,class:"text-center pa-4"},ee={class:"mt-3"},te={key:3,class:"text-center pa-4"},ae=s("div",{class:"mt-2"},"Loading constants...",-1),ne=["innerHTML"],oe=["innerHTML"],se=["innerHTML"],re=["innerHTML"];function le(e,t,l,g,ie,de){return c(),f(x,{class:"fill-height"},{default:n(()=>[o(L,{class:"d-flex text-center fill-height"},{default:n(()=>[o(B,{class:"mx-auto",variant:"outlined"},{default:n(()=>[o(N,null,{default:n(()=>[Q]),_:1}),o(E,null,{default:n(()=>[o(u,{variant:"outlined","prepend-icon":"mdi-arrow-left",onClick:e.returnToSearchPage},{default:n(()=>[d(" Return To Search Page ")]),_:1},8,["onClick"]),o(T),s("div",U,h(e.searchResult.length)+" result(s)",1),o(D,{items:e.pageSizeOptions,modelValue:e.itemsPerPage,"onUpdate:modelValue":t[0]||(t[0]=a=>e.itemsPerPage=a),label:"Rows per page",density:"compact",style:{"max-width":"160px"}},null,8,["items","modelValue"])]),_:1})]),_:1}),o(S,{justify:"center",class:"pt-10"},{default:n(()=>[o(F,{cols:"12"},{default:n(()=>[e.searchResult.length===0?(c(),f(v,{key:0,type:"info",variant:"tonal",border:"start",class:"mb-6"},{default:n(()=>[d(" No results found. Try a different ligand name or adjust your filters. ")]),_:1})):(c(),f(y,{key:1,"items-per-page":e.itemsPerPage,"onUpdate:itemsPerPage":t[1]||(t[1]=a=>e.itemsPerPage=a),expanded:e.expandedRows,"onUpdate:expanded":t[2]||(t[2]=a=>e.expandedRows=a),"group-by":e.groupBy,headers:e.headers,items:e.searchResult,"item-value":"name","show-expand":"",class:"elevation-1"},{"group-header":n(({item:a,columns:i,toggleGroup:r,isGroupOpen:C})=>[s("tr",I,[s("td",{colspan:i.length},[o(u,{size:"small",variant:"text",class:b(`ml-${a.depth*5}`),icon:C(a)?"$expand":"$next",onClick:ce=>r(a)},null,8,["class","icon","onClick"]),s("span",{innerHTML:a.value},null,8,A)],8,z)])]),"expanded-row":n(({columns:a,item:i})=>[s("tr",null,[s("td",{colspan:a.length,class:"pa-4"},[e.loadingConstants[e.getMetalKey(i.raw)]?(c(),m("div",W,[o(_,{indeterminate:"",color:"primary"}),X])):e.constantsData[e.getMetalKey(i.raw)]&&e.constantsData[e.getMetalKey(i.raw)].length>0?(c(),m("div",Y,[Z,o(y,{headers:e.constantHeaders,items:e.constantsData[e.getMetalKey(i.raw)],"items-per-page":20,class:"elevation-1"},{"item.expression_string":n(({item:r})=>[s("div",{innerHTML:r.expression_string||"-"},null,8,q)]),"item.constant_kind":n(({item:r})=>[d(h(r.constant_kind||"-"),1)]),"item.temperature":n(({item:r})=>[d(h(r.temperature!==void 0?r.temperature+(r.temperature_varies?" (varies)":""):"-"),1)]),"item.ionic_strength":n(({item:r})=>[d(h(r.ionic_strength!==void 0?r.ionic_strength:"-"),1)]),"item.value":n(({item:r})=>[d(h(r.value!==void 0?e.formatValue(r.value,r.significant_figures):"-"),1)]),_:2},1032,["headers","items"]),s("div",G,[o(u,{color:"primary","prepend-icon":"mdi-share",onClick:r=>e.goToDetailPage(i.raw)},{default:n(()=>[d(" View Full Details ")]),_:2},1032,["onClick"])])])):e.constantsData[e.getMetalKey(i.raw)]&&e.constantsData[e.getMetalKey(i.raw)].length===0?(c(),m("div",J,[o(v,{type:"info",variant:"tonal"},{default:n(()=>[d(" No constants data available for this metal-ligand combination. ")]),_:1}),s("div",ee,[o(u,{color:"primary","prepend-icon":"mdi-share",onClick:r=>e.goToDetailPage(i.raw)},{default:n(()=>[d(" View Detail Page ")]),_:2},1032,["onClick"])])])):(c(),m("div",te,[o(_,{indeterminate:"",color:"primary"}),ae]))],8,j)])]),"item.actions":n(({item:a})=>[o(u,{rounded:"pill",color:"primary","prepend-icon":"mdi-share",onClick:i=>e.goToDetailPage(a.raw)},{default:n(()=>[d(" Detail ")]),_:2},1032,["onClick"]),o(u,{class:"ml-2",rounded:"pill",color:"secondary","prepend-icon":"mdi-open-in-new",onClick:i=>e.openDetailInNewTab(a.raw)},{default:n(()=>[d(" Open ")]),_:2},1032,["onClick"]),o(u,{class:"ml-2",rounded:"pill",color:"tertiary","prepend-icon":"mdi-content-copy",onClick:i=>e.copyLink(a.raw)},{default:n(()=>[d(" Copy Link ")]),_:2},1032,["onClick"])]),"item.name":n(({item:a})=>[s("span",{innerHTML:e.highlightMatch(a.raw.name)},null,8,ne)]),"item.molecular_formula":n(({item:a})=>[s("div",{innerHTML:a.raw.molecular_formula},null,8,oe)]),"item.form":n(({item:a})=>[s("div",{class:"no-katex-html",innerHTML:e.getFormattedProtonationForm(a.raw.form)},null,8,se)]),"item.metal_charge":n(({item:a})=>[o($,{class:"ma-1",color:"blue",onClick:i=>e.filterByMetal(a.raw.central_element)},{default:n(()=>[d(h(a.raw.metal_charge>0?`+${a.raw.metal_charge}`:a.raw.metal_charge),1)]),_:2},1032,["onClick"])]),"item.formula_string":n(({item:a})=>[s("div",{class:"no-katex-html",innerHTML:e.getFormattedMetalForm(a.raw.formula_string)},null,8,re)]),_:2},1032,["items-per-page","expanded","group-by","headers","items"]))]),_:1})]),_:1})]),_:1})]),_:1})}const ye=R(O,[["render",le]]);export{ye as default};
